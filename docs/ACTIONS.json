{
  "actions": [
    {
      "type": "create",
      "path": "Dockerfile",
      "purpose": "FastAPI app container, Python 3.10-slim base, uvicorn server",
      "acceptance": "docker build -t dyn365hunter-api . → success, image oluşuyor",
      "priority": "P0"
    },
    {
      "type": "create",
      "path": "docker-compose.yml",
      "purpose": "PostgreSQL 15-alpine + FastAPI services, healthcheck, volumes, networks",
      "acceptance": "docker-compose up -d → postgres healthy, api healthy",
      "priority": "P0"
    },
    {
      "type": "create",
      "path": ".dockerignore",
      "purpose": "Docker build context optimization, exclude tests/.git/__pycache__",
      "acceptance": "docker build → küçük context size",
      "priority": "P0"
    },
    {
      "type": "create",
      "path": "setup_dev.sh",
      "purpose": "One-command dev environment setup: Docker check, .env copy, compose up, schema migration, healthcheck",
      "acceptance": "bash setup_dev.sh → success, /healthz 200 OK",
      "priority": "P0"
    },
    {
      "type": "create",
      "path": ".env.example",
      "purpose": "Environment variables template: DATABASE_URL, POSTGRES_*, API_*, LOG_LEVEL",
      "acceptance": "cp .env.example .env → valid env vars, Docker Compose çalışıyor",
      "priority": "P0"
    },
    {
      "type": "create",
      "path": "requirements.txt",
      "purpose": "Python dependencies: fastapi, uvicorn, sqlalchemy, psycopg2-binary, dnspython, python-whois, pydantic-settings, pandas, pytest",
      "acceptance": "pip install -r requirements.txt → tüm paketler yükleniyor",
      "priority": "P0"
    },
    {
      "type": "create",
      "path": "app/__init__.py",
      "purpose": "Python package marker",
      "acceptance": "import app → no error",
      "priority": "P0"
    },
    {
      "type": "create",
      "path": "app/main.py",
      "purpose": "FastAPI app, route registration, /healthz endpoint",
      "acceptance": "uvicorn app.main:app → /healthz 200 OK",
      "priority": "P0"
    },
    {
      "type": "create",
      "path": "app/config.py",
      "purpose": "Pydantic Settings: DATABASE_URL, API_HOST, API_PORT, LOG_LEVEL, environment variables",
      "acceptance": "from app.config import settings; settings.database_url → valid",
      "priority": "P0"
    },
    {
      "type": "create",
      "path": "app/db/__init__.py",
      "purpose": "Python package marker",
      "acceptance": "import app.db → no error",
      "priority": "P0"
    },
    {
      "type": "create",
      "path": "app/db/session.py",
      "purpose": "SQLAlchemy engine, session factory, PostgreSQL connection",
      "acceptance": "from app.db.session import get_db; next(get_db()) → DB session oluşuyor",
      "priority": "P0"
    },
    {
      "type": "create",
      "path": "app/db/schema.sql",
      "purpose": "PostgreSQL DDL: CREATE TABLE raw_leads, companies, domain_signals, lead_scores, VIEW leads_ready",
      "acceptance": "psql -f schema.sql → 4 table + 1 VIEW oluşuyor",
      "priority": "P0"
    },
    {
      "type": "create",
      "path": "app/db/models.py",
      "purpose": "SQLAlchemy models: RawLead, Company, DomainSignal, LeadScore",
      "acceptance": "from app.db.models import Company; Company.domain → UNIQUE constraint",
      "priority": "P0"
    },
    {
      "type": "create",
      "path": "app/core/__init__.py",
      "purpose": "Python package marker",
      "acceptance": "import app.core → no error",
      "priority": "P0"
    },
    {
      "type": "create",
      "path": "app/core/normalizer.py",
      "purpose": "Domain normalization: normalize_domain(), extract_domain_from_email(), extract_domain_from_website()",
      "acceptance": "normalize_domain('WWW.EXAMPLE.COM') → 'example.com'",
      "priority": "P0"
    },
    {
      "type": "create",
      "path": "app/core/analyzer_dns.py",
      "purpose": "DNS analysis: get_mx_records(), check_spf(), check_dkim(), check_dmarc(), analyze_dns(), timeout 10s",
      "acceptance": "analyze_dns('example.com') → MX/SPF/DKIM/DMARC değerleri",
      "priority": "P0"
    },
    {
      "type": "create",
      "path": "app/core/analyzer_whois.py",
      "purpose": "WHOIS lookup: get_whois_info(), timeout 5s, graceful fail",
      "acceptance": "get_whois_info('example.com') → registrar/expires_at/nameservers veya None",
      "priority": "P0"
    },
    {
      "type": "create",
      "path": "app/core/provider_map.py",
      "purpose": "Provider mapping: load_providers(), classify_provider() (MX root → M365/Google/Hosting/Local/Unknown)",
      "acceptance": "classify_provider('outlook-com.olc.protection.outlook.com') → 'M365'",
      "priority": "P0"
    },
    {
      "type": "create",
      "path": "app/core/scorer.py",
      "purpose": "Rule-based scoring: load_rules(), calculate_score(), determine_segment(), score_domain()",
      "acceptance": "score_domain('example.com') → score + segment + reason",
      "priority": "P0"
    },
    {
      "type": "create",
      "path": "app/core/merger.py",
      "purpose": "Company upsert: upsert_companies() (domain unique key, raw_leads → companies)",
      "acceptance": "upsert_companies() → companies tablosuna idempotent upsert",
      "priority": "P0"
    },
    {
      "type": "create",
      "path": "app/api/__init__.py",
      "purpose": "Python package marker",
      "acceptance": "import app.api → no error",
      "priority": "P0"
    },
    {
      "type": "create",
      "path": "app/api/ingest.py",
      "purpose": "Ingest endpoints: POST /ingest/domain, POST /ingest/csv (multipart, pandas parse)",
      "acceptance": "POST /ingest/domain → 201, raw_leads tablosunda kayıt",
      "priority": "P0"
    },
    {
      "type": "create",
      "path": "app/api/scan.py",
      "purpose": "Scan endpoint: POST /scan/domain (DNS + WHOIS + scoring, domain_signals + lead_scores yazma)",
      "acceptance": "POST /scan/domain → 200, score dönüyor, ≤10s",
      "priority": "P0"
    },
    {
      "type": "create",
      "path": "app/api/leads.py",
      "purpose": "Leads endpoints: GET /leads (filter: segment/min_score/provider), GET /lead/{domain}",
      "acceptance": "GET /leads?segment=Migration&min_score=70 → filtered results",
      "priority": "P0"
    },
    {
      "type": "create",
      "path": "app/data/providers.json",
      "purpose": "Provider mapping data: 10+ provider (M365, Google, Yandex, Hosting, Local, Unknown) + MX root examples",
      "acceptance": "load_providers() → 10+ provider yükleniyor, valid JSON",
      "priority": "P0"
    },
    {
      "type": "create",
      "path": "app/data/rules.json",
      "purpose": "Scoring rules: base_score, provider_points, signal_points, segment_rules (order matters)",
      "acceptance": "load_rules() → rules yükleniyor, valid JSON, segment logic çalışıyor",
      "priority": "P0"
    },
    {
      "type": "create",
      "path": "tests/__init__.py",
      "purpose": "Python package marker",
      "acceptance": "pytest tests/ → no import error",
      "priority": "P1"
    },
    {
      "type": "create",
      "path": "tests/test_scan_single.py",
      "purpose": "DNS/WHOIS analyzer tests: mock DNS/WHOIS, edge cases (timeout, invalid domain)",
      "acceptance": "pytest tests/test_scan_single.py → ≥5 test geçiyor",
      "priority": "P1"
    },
    {
      "type": "create",
      "path": "tests/test_scorer_rules.py",
      "purpose": "Scoring rules tests: score calculation, segment logic, edge cases (override, missing MX)",
      "acceptance": "pytest tests/test_scorer_rules.py → ≥5 test geçiyor",
      "priority": "P1"
    },
    {
      "type": "create",
      "path": "tests/test_ingest_csv.py",
      "purpose": "CSV ingestion tests: CSV parsing, normalization, edge cases (malformed CSV, empty file)",
      "acceptance": "pytest tests/test_ingest_csv.py → ≥5 test geçiyor",
      "priority": "P1"
    },
    {
      "type": "create",
      "path": "README.md",
      "purpose": "Setup instructions, .env template, WSL2 + Docker setup, demo commands, acceptance criteria",
      "acceptance": "Yeni kullanıcı README'yi takip edip setup yapabiliyor",
      "priority": "P0"
    }
  ]
}

